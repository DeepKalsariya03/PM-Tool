{% extends 'base.html' %}

{% block title %}Project Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">

    {% if current_user.role == 'admin' or current_user.role == 'manager' %}
    <div class="mb-4">
        <a href="{{ url_for('project.create_project') }}" class="btn btn-primary">+ Create New Project</a>
    </div>
    {% endif %}
    
    <!-- Project Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5>Ongoing Projects</h5>
                    <h2>{{ ongoing_count }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5>Completed Projects</h5>
                    <h2>{{ completed_count }}</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between mb-4">
        <!-- Search Bar -->
        <form method="GET" action="{{ url_for('project.view_projects') }}" class="d-flex align-items-center">
            <input type="text" name="search" class="form-control mr-2" placeholder="Search projects..." value="{{ request.args.get('search', '') }}">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    
        <!-- Filter Options -->
        <form method="GET" action="{{ url_for('project.view_projects') }}" class="d-flex align-items-center">
            <select name="status" class="form-select mr-2" onchange="this.form.submit()">
                <option value="">Filter by Status</option>
                <option value="Active" {% if request.args.get('status') == 'Active' %}selected{% endif %}>Active</option>
                <option value="Completed" {% if request.args.get('status') == 'Completed' %}selected{% endif %}>Completed</option>
                <option value="On Hold" {% if request.args.get('status') == 'On Hold' %}selected{% endif %}>On Hold</option>
            </select>
    
            <select name="deadline" class="form-select mr-2" onchange="this.form.submit()">
                <option value="">Filter by Deadline</option>
                <option value="this_week" {% if request.args.get('deadline') == 'this_week' %}selected{% endif %}>This Week</option>
                <option value="this_month" {% if request.args.get('deadline') == 'this_month' %}selected{% endif %}>This Month</option>
                <option value="1_year" {% if request.args.get('deadline') == '1_year' %}selected{% endif %}>In 1 Year</option>
            </select>
        </form>
    </div>
    
    

    <!-- Project Overview -->
    {% for project in projects %}
    <div class="card mb-3">
        <div class="card-body">
            <h2>{{ project.name }}</h2>
            <p><strong>Manager:</strong> {{ project.manager.username }}</p>
            <p><strong>Status:</strong> {{ project.status }}</p>
            <p><strong>Deadline:</strong> {{ project.deadline }}</p>

            <!-- Task Progress Overview -->
            <h4>Task Progress</h4>
            <div class="progress mb-4">
                <!-- Calculate completion percentage -->
                <div class="progress-bar" role="progressbar" style="width: {{ project.task_progress }}%">
                    {{ project.task_progress }}%
                </div>
            </div>

            <!-- View Project Details -->
            <a href="{{ url_for('project.view_project_detail', project_id=project.id) }}" class="btn btn-sm btn-outline-primary">View Details</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
